# NIIKI

## ê¸°íšì˜ë„
> í•™ì›ì—ì„œ ë°°ìš´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì¼ê¸°ì¥ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ëŠ” SNSë¥¼ ì œì‘í•´ë³´ì í•˜ëŠ” ì˜ë„ì—ì„œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. í‰ì†Œì—ëŠ” ì¼ê¸°ì¥ê³¼ ê°™ì´ í™œìš©ì„ í•˜ë‹¤ê°€ ë‹¤ë¥¸ ì‚¬ëŒì˜ ì¡°ì–¸ì´ í•„ìš”í•˜ê±°ë‚˜ ê³ ë¯¼ ìƒë‹´ì´ í•„ìš”í•  ë•Œ ê³ ë¯¼ ê²Œì‹œíŒìœ¼ë¡œ ì¼ê¸°ë¥¼ ë³´ë‚´ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ì†Œí†µì„ í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒì„ ì¤‘ì ìœ¼ë¡œ ì œì‘í–ˆìŠµë‹ˆë‹¤.
## ê°œë°œí™˜ê²½
- OS: window10
- IDE: Eclipse
- Server: Apache tomcat 9.0
- DB: MySQL
- Language: JAVA, JSP, JavaScropt(jquery)
- framework: Spring, bootstrap
- ORM: MyBatis
## UIì„¤ê³„
![Screenshot 2021-01-28 ì˜¤ì „ 2_28_23](https://user-images.githubusercontent.com/71121964/106030196-44b54200-6111-11eb-9275-f71eb08d7842.png)
- ë§í¬: https://xd.adobe.com/view/04dce06f-d797-407d-80fd-6714a93d9d87-518f/?fullscreen
## Database ERD
![ExampleERD](https://user-images.githubusercontent.com/71121964/105983757-8a0b4c80-60dc-11eb-8342-b07f756fd380.PNG)
## NIIKI ê¸°ëŠ¥ ì„¤ëª…
![ezgif com-gif-maker](https://user-images.githubusercontent.com/71121964/105987500-b5dd0100-60e1-11eb-9bb8-9b732234177c.gif)
### êµ¬í˜„ ê¸°ëŠ¥
#### [ê´€ë¦¬ì ê¸°ëŠ¥]
------------
ğŸš§
#### [ì‚¬ìš©ì ê¸°ëŠ¥]
------------
- ë¡œê·¸ì¸ í˜ì´ì§€
- íšŒì›ê°€ì…
  - ì´ë©”ì¼ ì¸ì¦
- ë‚´ ì •ë³´
  - ì‚¬ì§„ ë³€ê²½
  - íšŒì› ì •ë³´ ë³€ê²½
  - ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
  - íšŒì›íƒˆí‡´
- ë‚´ ì¼ê¸°ì¥
- ê³ ë¯¼ìƒë‹´ì†Œ
  - ê²€ìƒ‰ì°½
- ì•„ì´ë”” ì°¾ê¸°
- ì•„ì´ë”” ì°¾ê¸° ê²°ê³¼ì°½
  - ë¡œê·¸ì¸ í•˜ê¸°
  - ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
- ê²Œì‹œê¸€_ê³ ë¯¼ìƒë‹´ì†Œ
  - ì¶”ì²œí•˜ê¸°
- ê²Œì‹œê¸€_ì¼ê¸°ì¥
  - ê³µìœ í•˜ê¸°
- ê¸€ì“°ê¸° ì°½
- ê¸€ìˆ˜ì • ì°½
- ì´ë©”ì¼ ë³´ë‚´ê¸° ê²°ê³¼ì°½
## êµ¬í˜„ ê¸°ëŠ¥ ì„¤ëª…
### ë¡œê·¸ì¸ í˜ì´ì§€ 
![ezgif com-gif-maker (1)](https://user-images.githubusercontent.com/71121964/106282509-068c5f80-6284-11eb-933d-236eb73f99fc.gif)
> ë¡œê·¸ì¸ í›„ ë©”ì¸ í™”ë©´ì˜ ë¬¸êµ¬ê°€ ë³€ê²½ë¼ ì‚¬ìš©ìë¥¼ ë°˜ê²¨ì¤ë‹ˆë‹¤. ì´ë©”ì¼ ì¸ì¦ì„ ë°›ì•„ì•¼ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•˜ë©° ë¡œê·¸ì¸ ì‹œì—ëŠ” ì•„ì´ë”” ìœ ë¬´ í™•ì¸, ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤. ë¡œê·¸ì¸ì— ì„±ê³µí•  ì‹œ ìœ ì €ì˜ ë¡œê·¸ì¸ ì¼ìê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
#### Controller
```java
/*LoginPage ì—°ê²° Controller*/
	@GetMapping("/login")
	public String getLogin(@RequestParam(value="user_id", required = false) String user_id, Model model) throws Exception {
		model.addAttribute("user_id", user_id);
		return "/member/login";
	}
	@PostMapping("/login")
	public String PostLogin(@ModelAttribute("logInfo") MemberDTO mdto, HttpSession Msession, HttpServletResponse response) throws Exception {
		mdto = mservice.memberLogin(mdto, response);
		Msession.setAttribute("mdto", mdto);
		return "/index";	
	}
```
#### Service
```java
/*ë¡œê·¸ì¸ ê¸°ëŠ¥*/
	public MemberDTO memberLogin(MemberDTO mdto, HttpServletResponse response) throws Exception {
		response.setContentType("text/html;charset=utf-8");
		PrintWriter out = response.getWriter();
		//ì•„ì´ë”” í™•ì¸
		if(mdao.userID_check(mdto.getUser_id()) == 0) {
			out.println("<script>");
			out.println("alert('ë“±ë¡ëœ ì•„ì´ë””ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')");
			out.println("history.go(-1);");
			out.println("</script>");
			out.close();
			return null;
		}
		//ë¹„ë°€ë²ˆí˜¸ í™•ì¸
		else {
			String user_pw = mdto.getUser_pw();
			mdto = mdao.memberLogin(mdto.getUser_id());
			if(!(mdto.getUser_pw().equals(user_pw))) {
				out.println("<script>");
				out.println("alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤.')");
				out.println("history.go(-1);");
				out.println("</script>");
				out.close();
				return null;
			}
			//ì´ë©”ì¼ ì¸ì¦ í™•ì¸
			else if(!(mdto.getApprovalStatus().equals("true"))) {
				out.println("<script>");
				out.println("alert('ì´ë©”ì¼ ì¸ì¦ í›„ ë¡œê·¸ì¸ í•˜ì„¸ìš”.')");
				out.println("history.go(-1);");
				out.println("</script>");
				out.close();
				return null;
			}
			//ë¡œê·¸ì¸ ì„±ê³µ
			else {
				mdao.update_log(mdto.getUser_id());
				return mdto;
			}
			
		}
	}
```
#### DAO
```java
<!-- ì•„ì´ë”” ìœ ë¬´ ì²´í¬ -->
  <select id="userID_check" resultType="int">
    select count(*)
    from member 
    where user_id=#{user_id};
  </select>
<!-- ë¡œê·¸ì¸ -->
  <select id="memberLogin" parameterType="String" resultType="com.niiki.dto.MemberDTO">
    select *  
    from member
    where user_id=#{user_id}
  </select>
<!-- ë¡œê·¸ì¸ ì¼ì ì—…ë°ì´íŠ¸ -->
  <update id="update_log" parameterType="String">
    update member
    set logDate = now()
    where user_id = #{user_id}
  </update>
```
### íšŒì›ê°€ì…
![ezgif com-gif-maker (2)](https://user-images.githubusercontent.com/71121964/107344598-fab35f80-6b05-11eb-9381-23747c04c6a6.gif)
> íšŒì›ê°€ì… ê´€ë ¨ ì°½ì…ë‹ˆë‹¤. íšŒì›ê°€ì…ì„ í•  ë™ì•ˆ ì•„ë˜ì™€ ê°™ì€ í™•ì¸ ê³¼ì •ì„ ê°€ì§‘ë‹ˆë‹¤.
>> 1. ì´ë¯¸ ì¤‘ë³µëœ ì•„ì´ë””ê°€ ì¡´ì¬í•œë‹¤ë©´ ê°€ì… ë¶ˆê°€
>> 2. ë¬¸ì ê¸¸ì´ê°€ 8ì ì´í•˜ 20ì ì´ìƒì¼ ë•Œ, ê³µë°±ì´ ì¡´ì¬í•  ë•Œ, ìˆ«ì ë° íŠ¹ìˆ˜ë¬¸ìë¥¼ í˜¼ìš©í•˜ì§€ ì•Šì•˜ì„ ì‹œ ê°€ì… ë¶ˆê°€
>> 3. ë¹„ë°€ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ ì‹œ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ê°€ ê°™ì§€ ì•Šë‹¤ë©´ ê°€ì… ë¶ˆê°€
>> 4. ìƒë…„ì›”ì¼ì´ ì •ìƒì ì´ì§€ ì•Šì„ ì‹œ(ex:0000-00-35) ê°€ì… ë¶ˆê°€
#### Controller
```java
/*íšŒì›ê°€ì… êµ¬í˜„*/
	//íšŒì›ê°€ì… ì°½
	@GetMapping("/join")
		public void getJoin() {	
	}
	//íšŒì›ê°€ì…
	@PostMapping("/join")
	public String postJoin(MemberDTO mdto, HttpServletResponse response, RedirectAttributes rttr) throws Exception {
		rttr.addFlashAttribute("result", mservice.memberJoin(mdto, response));
		return"redirect:/member/login";
	}
	
	//ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬(ajax)
	@PostMapping("/userID_check")
	public void userID_check(@RequestParam("user_id") String user_id, HttpServletResponse response) throws Exception{
		mservice.userID_check(user_id, response);
	}
	//ìƒë…„ì›”ì¼ ìœ íš¨ì„± ê²€ì‚¬(ajax)
	@PostMapping("/userBirthCheck")
	public ResponseEntity<String> userBirthCheck(@RequestParam("user_birth") String user_birth, String format, HttpServletResponse response) throws Exception {
		boolean result = mservice.userBirthCheck(user_birth,"yyyy-MM-dd", response);
		return result == true ? new ResponseEntity<>("true",HttpStatus.OK):
			new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);
	}
```
#### Service
```java
/*ê°€ì…ê´€ë ¨ ë¬´ì‘ìœ„ í‚¤ ìƒì„±*/
	public String createKey() {
		String key="";
		Random r = new Random();
		
		for(int i=0; i<8; i++) {
			key += r.nextInt(10);
		}
		
		return key;
	}
	/*End*/
	
/*íšŒì›ê°€ì… ê´€ë ¨ ê¸°ëŠ¥*/
	public int memberJoin(MemberDTO mdto, HttpServletResponse response) throws Exception {
		PrintWriter out = response.getWriter();
		response.setContentType("text/html;charset=utf-8");
		
		if(mdao.userID_check(mdto.getUser_id()) == 1) {
			out.println("<script>");
			out.println("alert('ë™ì¼í•œ ì•„ì´ë””ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.');");
			out.println("history.go(-1)");
			out.println("</script>");
			out.close();
			return 0;
		} else {
			mdto.setApprovalKey(createKey());
			mdao.memberJoin(mdto);
			send_mail(mdto,"join");
			return 1;
		}
	}
	/*End*/
	
/*ìœ ì €ì•„ì´ë”” ì¤‘ë³µ ì²´í¬*/
	public void userID_check(String id, HttpServletResponse response) throws Exception {
		PrintWriter out = response.getWriter();
		out.println(mdao.userID_check(id));
		out.close();
	}
	/*End*/
```
#### DAO
```java
<!-- ì•„ì´ë”” ìœ ë¬´ ì²´í¬ -->
  <select id="userID_check" resultType="int">
    select count(*)
    from member 
    where user_id=#{user_id};
  </select>
<!-- ì•„ì´ë”” ìœ ë¬´ ì²´í¬ -->	
  <insert id="memberJoin">
    insert into member values(
    #{user_id}, #{user_pw}, #{user_name}, #{user_birth}, #{user_gender}, #{user_email}, now(), now(), 'false', #{approvalKey}, null)
  </insert>
```
### ë‚´ ì •ë³´
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ë‚´ ì¼ê¸°ì¥
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ê³ ë¯¼ìƒë‹´ì†Œ
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ì•„ì´ë”” ì°¾ê¸°
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ì•„ì´ë”” ì°¾ê¸° ê²°ê³¼ì°½
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ê²Œì‹œê¸€_ê³ ë¯¼ìƒë‹´ì†Œ
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ê²Œì‹œê¸€_ì¼ê¸°ì¥
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ê¸€ì“°ê¸° ì°½
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ê¸€ìˆ˜ì • ì°½
#### Controller
```java
```
#### Service
```java
```
#### DAO
```java
```
### ì´ë©”ì¼ ë³´ë‚´ê¸° ê²°ê³¼ì°½
#### Service
```java
public void send_mail(MemberDTO mdto, String div) throws Exception {
		// Mail Server ì„¤ì •
		String charSet = "utf-8";
		String hostSMTP = "smtp.naver.com";
		String hostSMTPid="leeujin1029";
		String hostSMTPpwd="*****";
		// ë°œì‹ ì EMail, ì œëª©, ë‚´ìš©
		String fromEmail = "leeujin1029@naver.com";
		String fromName="NIIKI";
		String subject ="";
		String msg = "";
		
		if(div.equals("join")) {
		// íšŒì›ê°€ì… ë©”ì¼ ë‚´ìš©
		subject = "NIIKI íšŒì›ê°€ì… ì¸ì¦ ë©”ì¼ì…ë‹ˆë‹¤.";
		msg += "<div align='center' style='border:1px solid black; font-family:verdana'>";
		msg += "<h3 style='color: blue;'>";
		msg += mdto.getUser_name()+"ë‹˜ íšŒì›ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤.</h3>";
		msg += "<div style='font-size: 130%'>";
		msg += "ì•„ë˜ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•œ í›„<br>í•˜ë‹¨ì˜ ì¸ì¦ ë²„íŠ¼ì„ í´ë¦­í•´ ì£¼ì„¸ìš”!</div><br/>";
		msg += "<form method='post' action='http://localhost:8080/member/approval_member'>";
		msg += "<p style='font-size:250%'>"+mdto.getApprovalKey()+"</p>";
		msg += "<input type='hidden' name='user_id' value='" + mdto.getUser_id() + "'>";
		msg += "<input type='text' name='approvalKey'><br>";
		msg += "<input type='submit' value='ì¸ì¦'></form><br/></div>";
		} else if(div.equals("findPw")) {
			subject += "NIIKI ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ë©”ì¼ì…ë‹ˆë‹¤.";
			msg +="<div align='center' style='border:1px solid black; font-family:verdana'>";
			msg +="<h3 style='color: blue;'>";
			msg += mdto.getUser_id()+"ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.</h3>";
			msg +="<p>ë¹„ë°€ë²ˆí˜¸: ";
			msg +=mdto.getUser_pw()+"</p></div>";
		}
		// ë°›ëŠ” ì‚¬ëŒ E-Mail ì£¼ì†Œ
		String mail = mdto.getUser_email();
		try {
			HtmlEmail email = new HtmlEmail();
			email.setDebug(true);
			email.setCharset(charSet);
			email.setSSL(true);
			email.setHostName(hostSMTP);
			email.setSmtpPort(***);
			
			email.setAuthentication(hostSMTPid, hostSMTPpwd);
			email.setTLS(true);
			email.addTo(mail, charSet);
			email.setFrom(fromEmail, fromName, charSet);
			email.setSubject(subject);
			email.setHtmlMsg(msg);
			email.send();
		} catch (Exception e) {
			e.printStackTrace();
			System.out.println("ë©”ì¼ë°œì†¡ ì‹¤íŒ¨: "+e);
		}
	}
```
